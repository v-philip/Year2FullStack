<!DOCTYPE html>
<html>

<head>
    <meta charset=UTF-8>
    <meta name=viewport content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js
        integrity=”sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q”
        crossorigin=”anonymous”></script>

    <script src=”https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js”
        integrity=”sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl”
        crossorigin=”anonymous”></script>
    <title>Basic Google Map Example</title>

    <style>
        #map {
            position: relative;
            margin: auto;
            width: 90%;
            height: 800px;
            border: thin solid #0a0a0a00;
        }

        #directions {
            position: relative;
        }

        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        select {
            width: 25%;
            height: 25%;
            margin: auto;
            position: relative;
            padding: auto;

        }

        .card {
            width: 18rem;
        }

        img {
            width: 100%;
            height: 100%;
        }
    </style>

    <!-- Google Maps -->
    <script async
        src=https://maps.googleapis.com/maps/api/js?key=AIzaSyCPNWtWAqzzab1WPbr5M0rKU6NYNZVOvYQ&callback=loadMap&libraries=places></script>

    <script>
        // thing to do 
        // Run on both mobile and laptop
        // Provide a visually pleasing display of the various tourist-related content
        // Show various useful tourist information on the map
        // Allow users to filter content
        // Allow users to show/hide Points of Interest on the map
        // Include custom content. The custom content must include images
        // Include custom markers
        // Read a JSON object from a JSON file and combine this with the results of a google.maps.place object (https://developers.google.com/maps/documentation/places/web-service/details#Place)
        // Allow the user to find a route between various locations
        // Display a LocalContext map of a separate, but related topic, on a second webpage

        map = null;
        let directionsRenderer = null

        let locations = {
            "Adelaide, Australia – Hindmarsh Stadium": {
                "latitude": -34.9073,
                "longitude": 138.5958,
                "place_id": "ChIJu9ujgk3PsGoRAG-6RVU2Aw8"
            },
            "Brisbane, Australia – Brisbane Stadium": {
                "latitude": -27.4580,
                "longitude": 153.0099,
                "place_id": "ChIJC5L-7atQkWsRALUh11ujAg8"
            },
            "Melbourne, Australia – Melbourne Rectangular Stadium": {
                "latitude": -37.8253,
                "longitude": 144.9833,
                "place_id": "ChIJC5L-7atQkWsRALUh11ujAg8"
            },
            "Perth, Australia – Perth Rectangular Stadium": {
                "latitude": -31.9448,
                "longitude": 115.8355,
                "place_id": "ChIJEWAFm9u6MioRFvGLqG5U3KM"
            },

            "Stadium Australia": {
                "latitude": -33.8472,
                "longitude": 151.0634,
                "place_id": "ChIJEWAFm9u6MioRFvGLqG5U3KM"
            },
            "Allianz Stadium": {
                "latitude": -33.8938,
                "longitude": 151.2242,
                "place_id": "ChIJFdVgXwKuEmsR487D1VwluxM"
            },

            "Auckland, New Zealand – Eden Park": {
                "latitude": -36.8724,
                "longitude": 174.7447,
                "place_id": "ChIJEWAFm9u6MioRFvGLqG5U3KM"
            },
            "Dunedin, New Zealand – Dunedin Stadium": {
                "latitude": -45.8672,
                "longitude": 170.5071,
                "place_id": "ChIJuZVBRkGsLqgRE4Zw34pRKIQ"
            },
            "Hamilton, New Zealand – Waikato Stadium": {
                "latitude": -37.7866,
                "longitude": 175.2793,
                "place_id": "ChIJs1ZnkAsibW0RoOG02ReaEpk"

            },
            "Wellington, New Zealand – Wellington Regional Stadium": {
                "latitude": -41.2745,
                "longitude": 174.7831,
                "place_id": "ChIJR7KXhDquOG0RuEC90I2oEy0"
            }
        };



        function loadMap() {
            services_centre_location = null
            let icon = {
                url: "icon.png",
                scaledSize: new google.maps.Size(50, 50)
            }
            let fifaW = { lat: -33.891525, lng: 151.224121 }
            const CONTENT = 0,
                LATITUDE = 1,
                LONGITUDE = 2

            let dkitContent = `<div id=dkit-content>
                                       <h1>Dundalk Institute of Technology</h1>
                                       <div id=content>
                                           <img src = images/dkit_photo.png>
                                           <p>Dundalk Institute of Technology is the best place to study computing in Ireland.</p>
                                           <p>For more information, see our website<br><a href=https://www.dkit.ie>www.dkit.ie</a></p>
                                       </div>
                                   </div>`

            // let locations = [
            //     [dkitContent, 53.98485693, -6.39410164],
            //     ["Dundalk", 54.00428271, -6.40210535],
            //     ["Blackrock", 53.96251869, -6.36627104]
            // ]

            let locations = {
                "Adelaide, Australia – Hindmarsh Stadium": {
                    "latitude": -34.9073,
                    "longitude": 138.5958,
                    "place_id": "ChIJu9ujgk3PsGoRAG-6RVU2Aw8"
                },
                "Brisbane, Australia – Brisbane Stadium": {
                    "latitude": -27.4580,
                    "longitude": 153.0099,
                    "place_id": "ChIJC5L-7atQkWsRALUh11ujAg8"
                },
                "Melbourne, Australia – Melbourne Rectangular Stadium": {
                    "latitude": -37.8253,
                    "longitude": 144.9833
                },
                "Perth, Australia – Perth Rectangular Stadium": {
                    "latitude": -31.9448,
                    "longitude": 115.8355,
                    "place_id": "ChIJEWAFm9u6MioRFvGLqG5U3KM"
                },
                "Sydney, Australia – Stadium Australia and Sydney Football Stadium": {
                    "Stadium Australia": {
                        "latitude": -33.8472,
                        "longitude": 151.0634,
                        "place_id": "ChIJEWAFm9u6MioRFvGLqG5U3KM"
                    },
                    "Allianz Stadium": {
                        "latitude": -33.8938,
                        "longitude": 151.2242,
                        "place_id": "ChIJFdVgXwKuEmsR487D1VwluxM"
                    }
                },
                "Auckland, New Zealand – Eden Park": {
                    "latitude": -36.8724,
                    "longitude": 174.7447,
                    "place_id": "ChIJEWAFm9u6MioRFvGLqG5U3KM"
                },
                "Dunedin, New Zealand – Dunedin Stadium": {
                    "latitude": -45.8672,
                    "longitude": 170.5071,
                    "place_id": "ChIJuZVBRkGsLqgRE4Zw34pRKIQ"
                },
                "Hamilton, New Zealand – Waikato Stadium": {
                    "latitude": -37.7866,
                    "longitude": 175.2793,
                    "place_id": "ChIJs1ZnkAsibW0RoOG02ReaEpk"

                },
                "Wellington, New Zealand – Wellington Regional Stadium": {
                    "latitude": -41.2745,
                    "longitude": 174.7831,
                    "place_id": "ChIJR7KXhDquOG0RuEC90I2oEy0"
                }
            };

            // let map = new google.maps.Map(document.getElementById("map"), {
            //     zoom: 5,
            //     center: new google.maps.LatLng(locations[0][LATITUDE], locations[0][LONGITUDE]),
            //     mapTypeId: google.maps.MapTypeId.ROADMAP,
            //     mapTypeControlOptions: {
            //         mapTypeIds: ["roadmap", "satellite", "hide_poi"]
            //     }
            // })
            let firstElement = Object.keys(locations)[0];
            let latitude = locations[firstElement]["latitude"];
            let longitude = locations[firstElement]["longitude"]
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 5,
                center: new google.maps.LatLng(fifaW.lat, fifaW.lng),
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControlOptions: {
                    mapTypeIds: ["roadmap", "satellite", "hide_poi"]
                }
            })

            hidePointsOfInterest(map)


            let infoWindow = new google.maps.InfoWindow()
            for (const [key, value] of Object.entries(locations)) {
                let marker = new google.maps.Marker({
                    position: new google.maps.LatLng(value.latitude, value.longitude),
                    icon: icon,
                    map: map,

                })

                google.maps.event.addListener(marker, "click", () => {
                    infoWindow.setContent(key);
                    infoWindow.open(map, marker);
                    //to pan with zoom
                    map.setZoom(17);

                    map.panTo(marker.getPosition());


                    let service = new google.maps.places.PlacesService(map)

                    service.nearbySearch({
                        location: marker.getPosition(), // centre of the search
                        radius: 5000, // radius (in metres) of the search
                        type: "cafe"
                    }, getNearbyServicesMarkers)




                });
            }


            directionsRenderer = new google.maps.DirectionsRenderer()
            directionsRenderer.setMap(map)

            directionsRenderer.setPanel(document.getElementById("directions"))

            calculateRoute()

        }






        function getNearbyServicesMarkers(results, status) {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                results.forEach(result => {
                    createMarker(result)
                })
            }
        }



        //     function hidePointsOfInterest(map) {
        //         let styles = [
        //             {
        //                 "featureType": "poi",
        //                 "stylers": [{ "visibility": "off" }]
        //             }
        //         ]

        //         let styledMapType = new google.maps.StyledMapType(styles, { name: "POI Hidden", alt: "Hide Points of Interest" })
        //         map.mapTypes.set("hide_poi", styledMapType)

        //         // map.setMapTypeId("hide_poi")
        //     }
        //     let infoWindow = new google.maps.InfoWindow()

        //     // Object.keys(locations).forEach((key) => {
        //     //     const location = locations[key];
        //     //     let marker = new google.maps.Marker({
        //     //         position: new google.maps.LatLng(location.latitude, location.longitude),
        //     //         map: map,
        //     //     });

        //     //     infoWindow = new google.maps.InfoWindow();

        //     //     google.maps.event.addListener(marker, "click", () => {
        //     //         infoWindow.setContent(key);
        //     //         infoWindow.open(map, marker);
        //     //     });
        //     // });


        //function to check if the 
        function createMarker(place) {
            console.log("Pressed")
            let icon = {
                url: "cafe.png", // url
                scaledSize: new google.maps.Size(30, 30) // scale the image to an icon size
            }

            let marker = new google.maps.Marker({
                map: map,
                icon: icon,
                position: place.geometry.location
            })

            infoWindow = new google.maps.InfoWindow()

            google.maps.event.addListener(marker, "click", () => {
                infoWindow.setContent(place.name)
                infoWindow.open(map, marker)
            })
        }


        function hidePointsOfInterest(map) {
            let styles = [
                {
                    "featureType": "poi",
                    "stylers": [{ "visibility": "off" }]
                }
            ]

            let styledMapType = new google.maps.StyledMapType(styles, { name: "POI Hidden", alt: "Hide Points of Interest" })
            map.mapTypes.set("hide_poi", styledMapType)


        }

        function calculateRoute() {

            let start = document.getElementById("start").value
            let end = document.getElementById("end").value

            let request = {
                origin: start,
                destination: end,
                travelMode: google.maps.TravelMode.DRIVING
            }

            directionsService = new google.maps.DirectionsService()
            directionsService.route(request, (route, status) => {
                if (status === google.maps.DirectionsStatus.OK) {
                    directionsRenderer.setDirections(route)
                }
            })

        }


        //  function getPhoto(place){
        //     //generate code to get the place id with the name of the place


        //     let service = new google.maps.places.PlacesService(map)
        //     var photo = "";
        //     service.getDetails({
        //         placeId: place
        //     }, (place, status) => {
        //         if (status === google.maps.places.PlacesServiceStatus.OK) {
        //             console.log(place)
        //             photo =  place.photos[0].getUrl({maxWidth: 100, maxHeight: 100})
        //         }
        //     })

        // }
        async function getPhoto(place) {
            return new Promise((resolve, reject) => {
                let service = new google.maps.places.PlacesService(map)
                service.getDetails({ placeId: place }, (place, status) => {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        console.log(place)
                        resolve(place.photos[0].getUrl({ maxWidth: 100, maxHeight: 100 }))
                    } else {
                        reject(new Error(`Failed to get photo for place ${place}: ${status}`))
                    }
                })
            })
        }


        //  function ReturnStadiums(){
        //     var htmlString = "hello" 
        //     for (const [key, value] of Object.entries(locations)){
        //         htmlString+=`<div class="card">`;
        //         var index = key.indexOf("–");
        //         var newStr =  getPhoto(value.place_id);
        //         console.log(newStr)
        //         console.log("index")
        //         htmlString+=`<img src="${newStr}" class="card-img-top" alt="${getPhoto(value.place_id)}">`
        //         htmlString+=`<div class="card-body">`
        //         htmlString+=`<h5 class="card-title">${key}</h5>`
        //         htmlString+=`</div></div>`
        //     }
        //     return htmlString
        // }
        async function ReturnStadiums() {
            var htmlString = "hello"
            for (const [key, value] of Object.entries(locations)) {
                htmlString += `<div class="card">`;
                var index = key.indexOf("–");
                try {
                    var newStr = await getPhoto(value.place_id);
                    console.log(newStr)
                    htmlString += `<img src="${newStr}" class="card-img-top" alt="${value.name}">`
                } catch (err) {
                    console.error(err)
                    htmlString += `<img src="" class="card-img-top" alt="${value.name}">`
                }
                htmlString += `<div class="card-body">`
                htmlString += `<h5 class="card-title">${key}</h5>`
                htmlString += `</div></div>`
            }
            return htmlString
        }
        //function to set the controle panel accordin to what is selected
        async function setControlePanel() {
            var opt = document.getElementById("sected").value
            if (opt === "route") {
                var htmlString = `<span class=select-location-label>Start:</span>
        <select id=start onChange=calculateRoute(true)>
            <option value="Adelaide, Australia Hindmarsh Stadium">Hindmarsh Stadium</option>
            <option value="Brisbane Stadium">Brisbane Stadium</option>
            <option value="Melbourne, Australia – Melbourne Rectangular Stadium">Melbourne Rectangular Stadium</option>
            <option value="Perth, Australia – Perth Rectangular Stadium"> Perth Rectangular Stadium</option>                 
        </select>

        <br>
        <span class=select-location-label>End:</span>
        <select id=end onChange=calculateRoute(true)>
            <option value="Adelaide, Australia Hindmarsh Stadium">Hindmarsh Stadium</option>
            <option value="Brisbane Stadium">Brisbane Stadium</option>
            <option value="Melbourne, Australia – Melbourne Rectangular Stadium">Melbourne Rectangular Stadium</option>
            <option value="Perth, Australia – Perth Rectangular Stadium"> Perth Rectangular Stadium</option>                     
        </select>`;
                document.getElementById("control-panel").innerHTML = htmlString;
            }

            else if (opt === "scrole trough") {
                document.getElementById("control-panel").innerHTML = "";
                document.getElementById("directions").innerHTML = "";
                document.getElementById("stadiums").innerHTML = "";
                directionsRenderer.setMap(null);
                loadMap();

            }
            else if (opt === "Stadiums") {
                document.getElementById("directions").innerHTML = "";
                document.getElementById("control-panel").innerHTML = "";
                document.getElementById("stadiums").innerHTML = await ReturnStadiums();
            }

        }

    </script>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Bootstrap Header</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Features</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Pricing</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                </li>
            </ul>
            <form class="form-inline my-2 my-lg-0">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0 inline" type="submit">Search</button>
            </form>
        </div>
    </nav>

    <select name="options" id="sected" onchange="setControlePanel()">
        <option value="route" selected>route</option>
        <option value="scrole trough">scrole trough</option>
        <option value="Stadiums">Stadiums</option>
        <option value="audi">Audi</option>
    </select>


    <!-- <span class=select-location-label>Start:</span>
        <select id=start onChange=calculateRoute()>
            <option value="Adelaide, Australia Hindmarsh Stadium">Hindmarsh Stadium</option>
            <option value="Brisbane Stadium">Brisbane Stadium</option>
            <option value="Melbourne, Australia – Melbourne Rectangular Stadium">Melbourne Rectangular Stadium</option>
            <option value="Perth, Australia – Perth Rectangular Stadium"> Perth Rectangular Stadium</option>                 
        </select>

        <br>
        <span class=select-location-label>End:</span>
        <select id=end onChange=calculateRoute()>
            <option value="Adelaide, Australia Hindmarsh Stadium">Hindmarsh Stadium</option>
            <option value="Brisbane Stadium">Brisbane Stadium</option>
            <option value="Melbourne, Australia – Melbourne Rectangular Stadium">Melbourne Rectangular Stadium</option>
            <option value="Perth, Australia – Perth Rectangular Stadium"> Perth Rectangular Stadium</option>                     
        </select> -->




    </div>
    <div id=map></div>
    <div id=directions></div>

    <div id="stadiums">

    </div>


    <div id="control-panel"></div>
    <footer class="bg-dark text-center text-white">
        <!-- Grid container -->
        <div class="container p-4 pb-0">
            <!-- Section: Social media -->
            <section class="mb-4">
                <!-- Facebook -->
                <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"><i
                        class="fab fa-facebook-f"></i></a>

                <!-- Twitter -->
                <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"><i
                        class="fab fa-twitter"></i></a>

                <!-- Google -->
                <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"><i
                        class="fab fa-google"></i></a>

                <!-- Instagram -->
                <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"><i
                        class="fab fa-instagram"></i></a>

                <!-- Linkedin -->
                <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"><i
                        class="fab fa-linkedin-in"></i></a>

                <!-- Github -->
                <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"><i
                        class="fab fa-github"></i></a>
            </section>
            <!-- Section: Social media -->
        </div>
        <!-- Grid container -->

        <!-- Copyright -->
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
            © 2020 Copyright:
            <a class="text-white" href="https://mdbootstrap.com/">MDBootstrap.com</a>
        </div>
    </footer>
</body>

</html>